<launch>
  <arg name="gui" default="false"/>

  <param name="/use_sim_time" value="true" />
  <node name="gazebo" pkg="gazebo_ros" type="gzserver"
      respawn="false" output="screen"
      args="-r $(find turtlebot_gazebo)/worlds/empty.world" />

  <group if="$(arg gui)">
    <node name="gazebo_gui" pkg="gazebo_ros" type="gzclient" respawn="false" output="screen"/>
  </group>

  <!-- Load guidance robot model-->
  <group ns="guidance" clear_params="true">
    <include file="$(find turtlebot_guidance)/launch/turtlebot_kobuki.launch">
      <arg name="namespace" value="guidance" />
      <arg name="init_x" value="0" />
      <arg name="init_y" value="0" />
      <arg name="init_yaw" value="0" />
    </include>
  </group>

  <group ns="follower" clear_params="true">
    <arg name="urdf_file" default="$(find xacro)/xacro --inorder '$(find turtlebot_guidance)/robot/turtlebot_follower.xacro'" />
    <param name="robot_description" command="$(arg urdf_file)" />

    <node name="spawn_turtlebot_model" pkg="gazebo_ros" type="spawn_model"
        args="-x 1.5 -y -0.05 -z 0.0 -Y 0.0 -urdf -param robot_description -model turtlebot_follower"
        respawn="false"/>

    <node pkg="robot_state_publisher" type="state_publisher" name="robot_state_publisher">
      <param name="publish_frequency" type="double" value="30.0"/>
      <param name="tf_prefix" type="string" value="follower" />
    </node>
  </group>

  <test pkg="turtlebot_guidance" type="test_state_detect" test-name="state_detect" time-limit="20.0"/>

</launch>
